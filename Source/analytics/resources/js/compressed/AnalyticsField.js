AnalyticsField=Garnish.Base.extend({init:function(t){"undefined"==typeof google.visualization?("undefined"==typeof AnalyticsChartLanguage&&(AnalyticsChartLanguage="en"),google.load("visualization","1",{packages:["corechart"],language:AnalyticsChartLanguage,callback:$.proxy(this,"initField",t)})):this.initField(t)},initField:function(t){this.$element=$("#"+t),this.$field=$(".analytics-field",this.$element),this.$spinner=$(".spinner",this.$element),this.$errorElement=$(".error",this.$element),this.$metricElement=$(".analytics-metric select",this.$element),this.$chartElement=$(".chart",this.$element),this.elementId=$(".analytics-field",this.$element).data("element-id"),this.locale=$(".analytics-field",this.$element).data("locale"),this.chart=!1,this.chartData=!1,this.addListener(Garnish.$win,"resize","resize"),this.addListener(this.$metricElement,"change","onMetricChange"),this.$metricElement.trigger("change")},onMetricChange:function(t){this.$metric=$(t.currentTarget).val(),this.request()},request:function(){this.chartData=new google.visualization.DataTable,this.$spinner.removeClass("hidden"),Craft.postActionRequest("analytics/field/elementReport",{elementId:this.elementId,locale:this.locale,metric:this.$metric},$.proxy(function(t){this.$spinner.addClass("hidden"),"undefined"!=typeof t.error?(this.$errorElement.html(t.error),this.$field.addClass("analytics-error")):(this.$field.removeClass("analytics-error"),this.chartData=Analytics.Utils.responseToDataTable(t.data),this.chart=new google.visualization.AreaChart(this.$chartElement.get(0)),"undefined"!=typeof this.chart&&this.chart.draw(this.chartData,this.chartOptions))},this))},resize:function(){this.chart&&this.chart.draw(this.chartData,this.chartOptions)},chartOptions:Analytics.ChartOptions.field()});