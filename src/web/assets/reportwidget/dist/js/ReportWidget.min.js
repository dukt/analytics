!function(e){Analytics.ReportWidget=Garnish.Base.extend({settings:null,report:null,localeDefinition:null,chartLanguage:null,$title:null,$body:null,$date:null,$spinner:null,$error:null,$report:null,init:function(t,s){var i;if(this.setSettings(s,Analytics.ReportWidget.defaults),this.localeDefinition=Analytics.Utils.getLocaleDefinition(this.settings.currencyDefinition),this.$element=e("#"+t),this.$title=e(".title",this.$element),this.$body=e(".body",this.$element),this.$date=e(".date",this.$element),this.$spinner=e(".spinner",this.$element),this.$spinner.removeClass("body-loading"),this.$error=e(".error",this.$element),e(this.$element).resize(function(){this.report&&this.report.resize()}.bind(this)),this.chartLanguage=s.chartLanguage,void 0!==s.request&&(i=s.request),void 0!==s.cachedResponse&&s.cachedResponse){this.$spinner.removeClass("hidden");var n=s.cachedResponse;this.parseResponse(n)}else i&&this.sendRequest(i)},sendRequest:function(t){this.$spinner.removeClass("hidden"),e(".report",this.$body).remove(),this.$error.addClass("hidden"),Craft.postActionRequest("analytics/reports/report-widget",t,e.proxy(function(e,t){if("success"==t&&void 0===e.error)this.parseResponse(e);else{var s="An unknown error occured.";void 0!==e&&e&&void 0!==e.error&&(s=e.error),this.$error.html(s),this.$error.removeClass("hidden"),this.$spinner.addClass("hidden")}window.dashboard&&window.dashboard.grid&&window.dashboard.grid.refreshCols(!0)},this))},parseResponse:function(t){var s=t,i=t.type,n=i.charAt(0).toUpperCase()+i.slice(1);this.$report=e('<div class="report"></div>'),this.$report.appendTo(this.$body),s.onAfterDraw=e.proxy(function(){this.$spinner.addClass("hidden")},this),this.report=new Analytics.reports[n](this.$report,s,this.localeDefinition,this.chartLanguage)}},{defaults:{chartLanguage:null,request:null,cachedResponse:null,currencyDefinition:null}})}(jQuery);
