Analytics.ReportWidget=Garnish.Base.extend({report:null,localeDefinition:null,chartLanguage:null,$title:null,$body:null,$date:null,$spinner:null,$error:null,$report:null,init:function(e,s){var t;if(this.$element=$("#"+e),this.$title=$(".title",this.$element),this.$body=$(".body",this.$element),this.$date=$(".date",this.$element),this.$spinner=$(".spinner",this.$element),this.$spinner.removeClass("body-loading"),this.$error=$(".error",this.$element),$(this.$element).resize(function(){this.report&&this.report.resize()}.bind(this)),this.localeDefinition=s.localeDefinition,this.chartLanguage=s.chartLanguage,void 0!==s.request&&(t=s.request),void 0!==s.cachedResponse&&s.cachedResponse){this.$spinner.removeClass("hidden");var i=s.cachedResponse;this.parseResponse(i)}else t&&this.sendRequest(t)},sendRequest:function(e){this.$spinner.removeClass("hidden"),$(".report",this.$body).remove(),this.$error.addClass("hidden"),Craft.postActionRequest("analytics/reports/report-widget",e,$.proxy(function(e,s){if("success"==s&&void 0===e.error)this.parseResponse(e);else{var t="An unknown error occured.";void 0!==e&&e&&void 0!==e.error&&(t=e.error),this.$error.html(t),this.$error.removeClass("hidden"),this.$spinner.addClass("hidden")}window.dashboard.grid.refreshCols(!0)},this))},parseResponse:function(e){var s=e,t=e.type,i=t.charAt(0).toUpperCase()+t.slice(1);this.$report=$('<div class="report"></div>'),this.$report.appendTo(this.$body),s.onAfterDraw=$.proxy(function(){this.$spinner.addClass("hidden")},this),this.report=new Analytics.reports[i](this.$report,s,this.localeDefinition,this.chartLanguage)}});
