Analytics.AccountExplorerV2=Garnish.Base.extend({data:null,$accountSelect:null,$propertySelect:null,$viewSelect:null,init:function(t,e){this.setSettings(e,Analytics.AccountExplorer.defaults),this.$container=$(t),this.$refreshViewsBtn=$(".refresh-views",this.$container),this.$spinner=$(".spinner",this.$container),this.$accountSelect=$(".account > select",this.$container),this.$propertySelect=$(".property > select",this.$container),this.$viewSelect=$(".view > select",this.$container),this.$reportingViewIdInput=$(".reporting-view-id",this.$container),console.log("reporting view ID: ",this.$reportingViewIdInput.val()),this.addListener(this.$refreshViewsBtn,"click","onRefresh"),this.addListener(this.$accountSelect,"change","onAccountChange"),this.addListener(this.$propertySelect,"change","onPropertyChange"),this.addListener(this.$viewSelect,"change","onViewChange"),this.requestExplorerData(this.$reportingViewIdInput.val())},requestExplorerData:function(t){this.$spinner.removeClass("hidden"),this.$refreshViewsBtn.addClass("disabled"),Craft.postActionRequest("analytics/settings/get-account-explorer-data",{},$.proxy(function(e,i){"success"==i?(e.error?alert(e.error):this.parseAccountExplorerData(e),"undefined"!=typeof t&&t&&this.selectView(t),this.$spinner.addClass("hidden"),this.$refreshViewsBtn.removeClass("disabled")):alert("Couldnâ€™t load account explorer data.")},this))},parseAccountExplorerData:function(t){this.data=t;var e=this.$accountSelect.val(),i=this.$propertySelect.val(),n=this.$viewSelect.val();this.updateAccountOptions(),this.updatePropertyOptions(),this.updateViewOptions(),e&&(this.$accountSelect.val(e),this.$accountSelect.trigger("change")),i&&(this.$propertySelect.val(i),this.$propertySelect.trigger("change")),n&&(this.$viewSelect.val(n),this.$viewSelect.trigger("change"))},selectView:function(t){if(t){console.log("viewId",t);var e,i,n;$.each(this.data.views,function(e,i){i.id==t&&(n=i)}),n&&($.each(this.data.accounts,function(t,i){i.id==n.accountId&&(e=i)}),$.each(this.data.properties,function(t,e){e.id==n.webPropertyId&&(i=e)})),e&&(this.$accountSelect.val(e.id),this.$accountSelect.trigger("change")),i&&(this.$propertySelect.val(i.id),this.$propertySelect.trigger("change")),n&&(this.$viewSelect.val(n.id),this.$viewSelect.trigger("change")),console.log("data",this.data),console.log("account, property, view",e,i,n)}},onRefresh:function(){this.requestExplorerData()},onAccountChange:function(){this.updatePropertyOptions(),this.onPropertyChange()},onPropertyChange:function(){this.updateViewOptions(),this.onViewChange()},onViewChange:function(){this.$reportingViewIdInput.val(this.$viewSelect.val())},updateAccountOptions:function(){$("option",this.$accountSelect).remove(),this.data&&$.each(this.data.accounts,$.proxy(function(t,e){var i=$("<option />").appendTo(this.$accountSelect);i.attr("value",e.id),i.text(e.name)},this))},updatePropertyOptions:function(){$("option",this.$propertySelect).remove(),this.data&&$.each(this.data.properties,$.proxy(function(t,e){if(e.accountId==this.$accountSelect.val()){var i=$("<option />").appendTo(this.$propertySelect);i.attr("value",e.id),i.text(e.name)}},this))},updateViewOptions:function(){$("option",this.$viewSelect).remove(),this.data&&$.each(this.data.views,$.proxy(function(t,e){if(e.webPropertyId==this.$propertySelect.val()){var i=$("<option />").appendTo(this.$viewSelect);i.attr("value",e.id),i.text(e.name)}},this))}},{defaults:{}});