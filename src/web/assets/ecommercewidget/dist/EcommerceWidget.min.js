!function(e){Analytics.EcommerceWidget=Garnish.Base.extend({settings:null,requestData:null,localeDefinition:null,$chart:null,init:function(t,i){this.setSettings(i,Analytics.EcommerceWidget.defaults),this.localeDefinition=Analytics.Utils.getLocaleDefinition(this.settings.currencyDefinition),this.$element=e("#"+t),this.$body=e(".body",this.$element),this.$spinner=e(".spinner",this.$element),this.$spinner.removeClass("body-loading"),this.$error=e('<div class="error hidden" />').appendTo(this.$body),this.$period=e(".period",this.$element),this.$revenue=e(".revenue",this.$element),this.$revenuePerTransaction=e(".revenue-per-transaction",this.$element),this.$transactions=e(".transactions",this.$element),this.$transactionsPerSession=e(".transactions-per-session",this.$element),this.$chart=e(".chart",this.$element),this.$tiles=e(".tiles",this.$element),this.sendRequest()},sendRequest:function(){this.$spinner.removeClass("hidden"),this.$error.addClass("hidden");var t={viewId:this.settings.viewId,period:this.settings.period};Craft.postActionRequest("analytics/reports/ecommerce-widget",t,e.proxy((function(e,t){if(this.$spinner.addClass("hidden"),"success"==t&&void 0===e.error)this.$tiles.removeClass("hidden"),this.$chart.removeClass("hidden"),this.parseResponse(e);else{var i="An unknown error occured.";void 0!==e&&e&&void 0!==e.error&&(i=e.error),this.$error.html(i),this.$error.removeClass("hidden"),this.$tiles.addClass("hidden"),this.$chart.addClass("hidden")}}),this))},parseResponse:function(e){var t=Analytics.Utils.formatByType(this.localeDefinition,"currency",e.totalRevenue),i=Analytics.Utils.formatByType(this.localeDefinition,"currency",e.totalRevenuePerTransaction),s=Analytics.Utils.formatByType(this.localeDefinition,"number",e.totalTransactions),n=Analytics.Utils.formatByType(this.localeDefinition,"percent",e.totalTransactionsPerSession);this.$period.html(e.period),this.$revenue.html(t),this.$revenuePerTransaction.html(i),this.$transactions.html(s),this.$transactionsPerSession.html(n),this.chart=new Analytics.reports.Area(this.$chart,e.reportData,this.localeDefinition,this.settings.chartLanguage)}},{defaults:{viewId:null,period:null,currencyDefinition:null,chartLanguage:null}})}(jQuery);
