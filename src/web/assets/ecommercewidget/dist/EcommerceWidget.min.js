!function(e){Analytics.EcommerceWidget=Garnish.Base.extend({settings:null,requestData:null,$chart:null,init:function(t,s){this.setSettings(s,Analytics.EcommerceWidget.defaults),this.$element=e("#"+t),this.$body=e(".body",this.$element),this.$spinner=e(".spinner",this.$element),this.$spinner.removeClass("body-loading"),this.$error=e('<div class="error hidden" />').appendTo(this.$body),this.$period=e(".period",this.$element),this.$revenue=e(".revenue",this.$element),this.$revenuePerTransaction=e(".revenue-per-transaction",this.$element),this.$transactions=e(".transactions",this.$element),this.$transactionsPerSession=e(".transactions-per-session",this.$element),this.$chart=e(".chart",this.$element),this.$tiles=e(".tiles",this.$element),this.sendRequest()},sendRequest:function(){this.$spinner.removeClass("hidden"),this.$error.addClass("hidden");var t={viewId:this.settings.viewId,period:this.settings.period};Craft.postActionRequest("analytics/reports/ecommerce-widget",t,e.proxy(function(e,t){if(this.$spinner.addClass("hidden"),"success"==t&&void 0===e.error)this.$tiles.removeClass("hidden"),this.$chart.removeClass("hidden"),this.parseResponse(e);else{var s="An unknown error occured.";void 0!==e&&e&&void 0!==e.error&&(s=e.error),this.$error.html(s),this.$error.removeClass("hidden"),this.$tiles.addClass("hidden"),this.$chart.addClass("hidden")}},this))},parseResponse:function(e){var t=this.settings.localeDefinition,s=Analytics.Utils.formatByType(t,"currency",e.totalRevenue),i=Analytics.Utils.formatByType(t,"currency",e.totalRevenuePerTransaction),n=Analytics.Utils.formatByType(t,"number",e.totalTransactions),r=Analytics.Utils.formatByType(t,"percent",e.totalTransactionsPerSession);this.$period.html(e.period),this.$revenue.html(s),this.$revenuePerTransaction.html(i),this.$transactions.html(n),this.$transactionsPerSession.html(r),this.chart=new Analytics.reports.Area(this.$chart,e.reportData,t,this.settings.chartLanguage)}},{defaults:{viewId:null,period:null,localeDefinition:null,chartLanguage:null}})}(jQuery);
