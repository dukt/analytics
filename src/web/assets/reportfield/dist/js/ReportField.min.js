AnalyticsReportField=Garnish.Base.extend({localeDefinition:null,init:function(e,t){this.setSettings(t,AnalyticsReportField.defaults),this.localeDefinition=Analytics.Utils.getLocaleDefinition(this.settings.currencyDefinition),this.$element=$("#"+e),this.$field=$(".analytics-field",this.$element),this.$metric=$(".analytics-metric select",this.$element),this.$chart=$(".chart",this.$element),this.$spinner=$(".spinner",this.$element),this.$error=$(".error",this.$element),this.elementId=$(".analytics-field",this.$element).data("element-id"),this.siteId=$(".analytics-field",this.$element).data("site-id"),this.metric=this.$metric.val(),this.addListener(this.$metric,"change","onMetricChange"),this.settings.cachedResponse?this.parseResponse(this.settings.cachedResponse):this.sendRequest()},onMetricChange:function(e){this.metric=$(e.currentTarget).val(),this.sendRequest()},sendRequest:function(){this.$spinner.removeClass("hidden"),this.$field.removeClass("analytics-error");var e={elementId:this.elementId,siteId:this.siteId,metric:this.metric};Craft.postActionRequest("analytics/reports/element",e,$.proxy(function(e,t){if("success"==t&&void 0===e.error)this.parseResponse(e);else{var i=Craft.t("An unknown error occurred.");void 0!==e&&e&&void 0!==e.error&&(i=e.error),this.$error.html(i),this.$error.removeClass("hidden"),this.$field.addClass("analytics-error")}this.$spinner.addClass("hidden")},this))},parseResponse:function(e){Garnish.requestAnimationFrame($.proxy(function(){e.chartOptions=Analytics.ChartOptions.field(),this.chart=new Analytics.reports.Area(this.$chart,e,this.localeDefinition,this.settings.chartLanguage)},this))}},{defaults:{cachedResponse:null,currencyDefinition:null}});
